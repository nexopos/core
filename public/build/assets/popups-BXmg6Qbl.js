import{f as M,g as j,h as E,i as Z,j as z,k as ee,l as te,m as se,b as N}from"./components-aaXmhHeN.js";import{v as B,a as W,c as ne}from"./runtime-dom.esm-bundler-fzjQKxQP.js";import{p as A,n as C,a as m,F,b as O,P as V,c as D,f as ie,d as L}from"./bootstrap-CdmlhdQh.js";import{_ as u,n as U}from"./currency-D9GCAB0l.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as h,c as a,o as l,a as e,t as i,f as b,b as _,F as x,x as w,e as k,w as P,g as S,y as R,z as T,s as re}from"./runtime-core.esm-bundler-C9jqhWqQ.js";import"./ns-avatar.vue_vue_type_script_setup_true_lang-COi-O-LX.js";import"./ns-avatar-image-PahYhT-s.js";import"./chart-wS9Fvaho.js";const oe={props:["popup"],mounted(){this.popuCloser(),this.loadFields(),this.product=this.popup.params.product},data(){return{formValidation:new F,fields:[],product:null}},methods:{__:u,popuCloser:A,close(){this.popup.params.reject(!1),this.popup.close()},addProduct(){if(this.formValidation.validateFields(this.fields),this.formValidation.fieldsValid(this.fields)){const s=this.formValidation.extractFields(this.fields),t={...this.product,...s};return this.popup.params.resolve(t),this.close()}m.error(u("The form is not valid."))},loadFields(){C.get("/api/fields/ns.refund-product").subscribe(s=>{this.fields=this.formValidation.createFields(s),this.fields.forEach(t=>{t.value=this.product[t.name]||""})})}}},le={class:"shadow-xl ns-box w-95vw md:w-3/5-screen lg:w-3/7-screen h-95vh md:h-[60vh] lg:h-[70vh] overflow-hidden flex flex-col"},de={class:"p-2 flex justify-between border-b ns-box-header items-center"},ae={class:"text-semibold"},ue={class:"flex-auto overflow-y-auto relative ns-scrollbar"},ce={class:"p-2"},fe={key:0,class:"h-full w-full flex items-center justify-center"},pe={class:"p-2 flex justify-between items-center border-t ns-box-body"};function _e(s,t,r,f,o,n){const y=h("ns-close-button"),d=h("ns-field"),c=h("ns-spinner"),v=h("ns-button");return l(),a("div",le,[e("div",de,[e("h3",ae,i(n.__("Products")),1),e("div",null,[b(y,{onClick:t[0]||(t[0]=p=>n.close())})])]),e("div",ue,[e("div",ce,[(l(!0),a(x,null,w(o.fields,(p,g)=>(l(),k(d,{key:g,field:p},null,8,["field"]))),128))]),o.fields.length===0?(l(),a("div",fe,[b(c)])):_("",!0)]),e("div",pe,[t[2]||(t[2]=e("div",null,null,-1)),e("div",null,[b(v,{onClick:t[1]||(t[1]=p=>n.addProduct()),type:"info"},{default:P(()=>[S(i(n.__("Add Product")),1)]),_:1})])])])}const G=Q(oe,[["render",_e]]),he={components:{nsNumpad:M},props:["popup"],data(){return{product:null,seeValue:0,availableQuantity:0}},mounted(){this.product=this.popup.params.product,this.availableQuantity=this.popup.params.availableQuantity,this.seeValue=this.product.quantity},methods:{__:u,popupResolver:O,close(){this.popup.params.reject(!1),this.popup.close()},setChangedValue(s){this.seeValue=s},updateQuantity(s){if(s>this.availableQuantity)return m.error("Unable to proceed as the quantity provided is exceed the available quantity.");this.product.quantity=parseFloat(s),this.popup.params.resolve(this.product),this.popup.close()}}},me={class:"shadow-xl ns-box overflow-hidden w-95vw md:w-2/3-screen lg:w-3/7-screen"},be={class:"p-2 flex justify-between ns-box-header"},ye={class:"font-semibold"},ve={key:0,class:"border-t border-b ns-box-body py-2 flex items-center justify-center text-2xl font-semibold"},xe={class:"text-fontcolor text-sm"},we={key:1,class:"flex-auto overflow-y-auto p-2"};function ge(s,t,r,f,o,n){const y=h("ns-close-button"),d=h("ns-numpad");return l(),a("div",me,[e("div",be,[e("h3",ye,i(n.__("Quantity")),1),e("div",null,[b(y,{onClick:t[0]||(t[0]=c=>n.close())})])]),o.product?(l(),a("div",ve,[e("span",null,i(o.seeValue),1),e("span",xe,"("+i(o.availableQuantity)+" "+i(n.__("available"))+")",1)])):_("",!0),o.product?(l(),a("div",we,[b(d,{value:o.product.quantity,onNext:t[1]||(t[1]=c=>n.updateQuantity(c)),onChanged:t[2]||(t[2]=c=>n.setChangedValue(c))},null,8,["value"])])):_("",!0)])}const Pe=Q(he,[["render",ge]]),ke={components:{nsNumpad:M},props:["order"],computed:{total(){return this.refundables.length>0?this.refundables.map(s=>parseFloat(s.unit_price)*parseFloat(s.quantity)).reduce((s,t)=>s+t)+this.shippingFees:0+this.shippingFees},shippingFees(){return this.refundShipping?this.order.shipping:0}},data(){return{isSubmitting:!1,formValidation:new F,refundables:[],paymentOptions:[],paymentField:[],print:new D({urls:systemUrls,options:systemOptions}),refundShipping:!1,selectedPaymentGateway:!1,screen:0,selectFields:[{type:"select",options:this.order.products.map(s=>({label:`${s.name} - ${s.unit.name} (x${s.quantity})`,value:s.id})),validation:"required",name:"product_id",label:u("Product"),description:u("Select the product to perform a refund.")}]}},methods:{__:u,nsCurrency:U,updateScreen(s){this.screen=s},toggleRefundShipping(s){this.refundShipping=s,this.refundShipping},proceedPayment(){if(this.selectedPaymentGateway===!1)return m.error(u("Please select a payment gateway before proceeding."));if(this.total===0)return m.error(u("There is nothing to refund."));if(this.screen===0)return m.error(u("Please provide a valid payment amount."));V.show(j,{title:u("Confirm Your Action"),message:u("The refund will be made on the current order."),onAction:s=>{s&&this.doProceed()}})},doProceed(){const s={products:this.refundables,total:this.screen,payment:{identifier:this.selectedPaymentGateway},refund_shipping:this.refundShipping};this.isSubmitting=!0,C.post(`/api/orders/${this.order.id}/refund`,s).subscribe({next:t=>{this.isSubmitting=!1,this.$emit("changed",!0),t.data.order.payment_status==="refunded"&&this.$emit("loadTab","details"),this.print.process(t.data.orderRefund.id,"refund"),m.success(t.message)},error:t=>{this.isSubmitting=!1,m.error(t.message)}})},addProduct(){if(this.formValidation.validateFields(this.selectFields),!this.formValidation.fieldsValid(this.selectFields))return m.error(u("Please select a product before proceeding."));const s=this.formValidation.extractFields(this.selectFields),t=this.order.products.filter(n=>n.id===s.product_id),r=this.refundables.filter(n=>n.id===s.product_id);if(r.length>0&&r.map(y=>parseInt(y.quantity)).reduce((y,d)=>y+d)===t[0].quantity)return m.error(u("Not enough quantity to proceed."));if(t[0].quantity===0)return m.error(u("Not enough quantity to proceed."));const f={...t[0],condition:"",description:""};new Promise((n,y)=>{V.show(G,{resolve:n,reject:y,product:f})}).then(n=>{n.quantity=this.getProductOriginalQuantity(n.id)-this.getProductUsedQuantity(n.id),this.refundables.push(n)},n=>n)},getProductOriginalQuantity(s){const t=this.order.products.filter(r=>r.id===s);return t.length>0?t.map(r=>parseFloat(r.quantity)).reduce((r,f)=>r+f):0},getProductUsedQuantity(s){const t=this.refundables.filter(r=>r.id===s);return t.length>0?t.map(f=>parseFloat(f.quantity)).reduce((f,o)=>f+o):0},openSettings(s){new Promise((r,f)=>{V.show(G,{resolve:r,reject:f,product:s})}).then(r=>{const f=this.refundables.indexOf(s);this.$set(this.refundables,f,r)},r=>r)},async selectPaymentGateway(){try{this.selectedPaymentGateway=await new Promise((s,t)=>{V.show(E,{resolve:s,reject:t,value:[this.selectedPaymentOption],...this.paymentField[0]})}),this.selectedPaymentGatewayLabel=this.paymentField[0].options.filter(s=>s.value===this.selectedPaymentGateway)[0].label}catch{m.error(u("An error has occured while seleting the payment gateway."))}},changeQuantity(s){new Promise((r,f)=>{const o=this.getProductOriginalQuantity(s.id)-this.getProductUsedQuantity(s.id)+parseFloat(s.quantity);V.show(Pe,{resolve:r,reject:f,product:s,availableQuantity:o})}).then(r=>{if(r.quantity>this.getProductUsedQuantity(s.id)-s.quantity){const f=this.refundables.indexOf(s);this.$set(this.refundables,f,r)}})},deleteProduct(s){new Promise((t,r)=>{V.show(j,{title:u("Confirm Your Action"),message:u("Would you like to delete this product ?"),onAction:f=>{if(f){const o=this.refundables.indexOf(s);this.refundables.splice(o,1)}}})})}},mounted(){this.selectFields=this.formValidation.createFields(this.selectFields),C.get("/api/orders/payments").subscribe(s=>{this.paymentField=s})}},Ce={class:"-m-4 flex-auto flex flex-wrap relative"},je={key:0,class:"bg-overlay h-full w-full flex items-center justify-center absolute z-30"},Se={class:"px-4 w-full lg:w-1/2"},Qe={class:"py-2 border-b-2 text-fontcolor border-info-primary"},Ve={class:"my-2"},qe={class:"border-b border-info-primary flex justify-between items-center mb-2"},Ue={class:"flex-auto flex-col flex"},Ae={class:"p-2 flex"},Fe={class:"flex justify-between p-2"},Oe={class:"flex items-center text-font"},De={key:0,class:"mr-2"},Te={class:"py-1 border-b-2 text-fontcolor border-info-primary"},Re={class:"px-2 text-fontcolor flex justify-between flex-auto"},$e={class:"flex flex-col"},Le={class:"py-2"},Ie={key:0,class:"rounded-full px-2 py-1 text-xs bg-error-tertiary mx-2 text-white"},Me={key:1,class:"rounded-full px-2 py-1 text-xs bg-success-tertiary mx-2 text-white"},Ye={class:"flex items-center justify-center"},Ne={class:"py-1 flex items-center cursor-pointer border-b border-dashed border-info-primary"},Be={class:"flex"},We=["onClick"],Ge=["onClick"],He=["onClick"],Ee={class:"px-4 w-full lg:w-1/2"},ze={class:"py-2 border-b-2 text-fontcolor border-info-primary"},Ke={class:"py-2"},Je={class:"elevation-surface border font-semibold flex mb-2 p-2 justify-between"},Xe={class:"elevation-surface border success font-semibold flex mb-2 p-2 justify-between"},Ze={class:"elevation-surface border font-semibold flex mb-2 p-2 justify-between"};function et(s,t,r,f,o,n){const y=h("ns-spinner"),d=h("ns-field"),c=h("ns-checkbox"),v=h("ns-numpad-plus");return l(),a("div",Ce,[o.isSubmitting?(l(),a("div",je,[b(y)])):_("",!0),e("div",Se,[e("h3",Qe,i(n.__("Refund With Products")),1),e("div",Ve,[e("ul",null,[e("li",qe,[e("div",Ue,[e("div",Ae,[(l(!0),a(x,null,w(o.selectFields,(p,g)=>(l(),k(d,{field:p,key:g},null,8,["field"]))),128))]),e("div",Fe,[e("div",Oe,[r.order.shipping>0?(l(),a("span",De,i(n.__("Refund Shipping")),1)):_("",!0),r.order.shipping>0?(l(),k(c,{key:1,onChange:t[0]||(t[0]=p=>n.toggleRefundShipping(p)),checked:o.refundShipping},null,8,["checked"])):_("",!0)]),e("div",null,[e("button",{onClick:t[1]||(t[1]=p=>n.addProduct()),class:"border rounded-full px-2 py-1 ns-inset-button info"},i(n.__("Add Product")),1)])])])]),e("li",null,[e("h4",Te,i(n.__("Products")),1)]),(l(!0),a(x,null,w(o.refundables,p=>(l(),a("li",{key:p.id,class:"elevation-surface border flex justify-between items-center mb-2"},[e("div",Re,[e("div",$e,[e("p",Le,[e("span",null,i(p.name),1),p.condition==="damaged"?(l(),a("span",Ie,i(n.__("Damaged")),1)):_("",!0),p.condition==="unspoiled"?(l(),a("span",Me,i(n.__("Unspoiled")),1)):_("",!0)]),e("small",null,i(p.unit.name),1)]),e("div",Ye,[e("span",Ne,i(n.nsCurrency(p.unit_price*p.quantity)),1)])]),e("div",Be,[e("p",{onClick:g=>n.openSettings(p),class:"p-2 border-l border-info-primary cursor-pointer text-fontcolor ns-numpad-key w-16 h-16 flex items-center justify-center"},t[5]||(t[5]=[e("i",{class:"las la-cog text-xl"},null,-1)]),8,We),e("p",{onClick:g=>n.deleteProduct(p),class:"p-2 border-l border-info-primary cursor-pointer text-fontcolor ns-numpad-key w-16 h-16 flex items-center justify-center"},t[6]||(t[6]=[e("i",{class:"las la-trash"},null,-1)]),8,Ge),e("p",{onClick:g=>n.changeQuantity(p),class:"p-2 border-l border-info-primary cursor-pointer text-fontcolor ns-numpad-key w-16 h-16 flex items-center justify-center"},i(p.quantity),9,He)])]))),128))])])]),e("div",Ee,[e("h3",ze,i(n.__("Summary")),1),e("div",Ke,[e("div",Je,[e("span",null,i(n.__("Total")),1),e("span",null,i(n.nsCurrency(n.total)),1)]),e("div",Xe,[e("span",null,i(n.__("Paid")),1),e("span",null,i(n.nsCurrency(r.order.tendered)),1)]),e("div",{onClick:t[2]||(t[2]=p=>n.selectPaymentGateway()),class:"elevation-surface border info font-semibold flex mb-2 p-2 justify-between cursor-pointer"},[e("span",null,i(n.__("Payment Gateway")),1),e("span",null,i(o.selectedPaymentGateway?s.selectedPaymentGatewayLabel:"N/A"),1)]),e("div",Ze,[e("span",null,i(n.__("Screen")),1),e("span",null,i(n.nsCurrency(o.screen)),1)]),e("div",null,[b(v,{currency:!0,onChanged:t[3]||(t[3]=p=>n.updateScreen(p)),value:o.screen,onNext:t[4]||(t[4]=p=>n.proceedPayment(p))},null,8,["value"])])])])])}const tt=Q(ke,[["render",et]]);class Y{getTypeLabel(t){const r=typeLabels.filter(f=>f.value===t);return r.length>0?r[0].label:u("Unknown Status")}getDeliveryStatus(t){const r=deliveryStatuses.filter(f=>f.value===t);return r.length>0?r[0].label:u("Unknown Status")}getProcessingStatus(t){const r=processingStatuses.filter(f=>f.value===t);return r.length>0?r[0].label:u("Unknown Status")}getPaymentStatus(t){const r=paymentLabels.filter(f=>f.value===t);return r.length>0?r[0].label:u("Unknown Status")}}const st={props:["order"],data(){return{labels:new Y,validation:new F,inputValue:0,print:new D({urls:systemUrls,options:systemOptions}),fields:[],paymentTypes}},computed:{paymentsLabels(){const s=new Object;return this.paymentTypes.forEach(t=>{s[t.value]=t.label}),s}},methods:{__:u,nsCurrency:U,updateValue(s){this.inputValue=s},loadPaymentFields(){C.get("/api/orders/payments").subscribe(s=>{this.fields=this.validation.createFields(s)})},printPaymentReceipt(s){this.print.process(s.id,"payment")},submitPayment(s){if(this.validation.validateFields(this.fields),!this.validation.fieldsValid(this.fields))return m.error(u("Unable to proceed the form is not valid"));if(parseFloat(s)==0)return m.error(u("Please provide a valid value"));s=parseFloat(s);const t={...this.validation.extractFields(this.fields),value:s};Popup.show(j,{title:u("Confirm Your Action"),message:u("You make a payment for {amount}. A payment can't be canceled. Would you like to proceed ?").replace("{amount}",U(s)),onAction:r=>{r&&C.post(`/api/orders/${this.order.id}/payments`,t).subscribe(f=>{m.success(f.message),this.$emit("changed")},f=>{m.error(f.message)})}})}},components:{nsNumpad:M},mounted(){this.loadPaymentFields()}},nt={class:"flex -mx-4 flex-wrap"},it={class:"px-2 w-full md:w-1/2"},rt={class:"my-1 h-12 py-1 px-2 flex justify-between items-center elevation-surface info border text-xl font-bold"},ot={class:"px-2 w-full md:w-1/2"},lt={class:"my-1 h-12 py-1 px-2 flex justify-between items-center elevation-surface success border text-xl font-bold"},dt={class:"px-2 w-full md:w-1/2"},at={class:"my-1 h-12 py-1 px-2 flex justify-between items-center elevation-surface error border text-xl font-bold"},ut={key:0},ct={key:1},ft={class:"px-2 w-full md:w-1/2"},pt={class:"my-1 h-12 py-1 px-2 flex justify-between items-center elevation-surface warning border text-xl font-bold"},_t={class:"flex -mx-4 flex-wrap"},ht={class:"px-2 w-full mb-4 md:w-1/2"},mt={key:0},bt={class:"font-semibold border-b-2 border-info-primary py-2"},yt={class:"py-2"},vt={class:"my-2 px-2 h-12 flex justify-end items-center border elevation-surface"},xt={key:1,class:"flex items-center justify-center h-full"},wt={class:"text-fontcolor font-semibold"},gt={class:"px-2 w-full mb-4 md:w-1/2"},Pt={class:"font-semibold border-b-2 border-info-primary py-2 mb-2"},kt={class:"flex items-center"},Ct=["onClick"];function jt(s,t,r,f,o,n){const y=h("ns-field"),d=h("ns-numpad-plus");return l(),a(x,null,[e("div",nt,[e("div",it,[e("div",rt,[e("span",null,i(n.__("Total")),1),e("span",null,i(n.nsCurrency(r.order.total)),1)])]),e("div",ot,[e("div",lt,[e("span",null,i(n.__("Paid")),1),e("span",null,i(n.nsCurrency(r.order.tendered)),1)])]),e("div",dt,[e("div",at,[e("span",null,i(n.__("Unpaid")),1),r.order.total-r.order.tendered>0?(l(),a("span",ut,i(n.nsCurrency(r.order.total-r.order.tendered)),1)):_("",!0),r.order.total-r.order.tendered<=0?(l(),a("span",ct,i(n.nsCurrency(0)),1)):_("",!0)])]),e("div",ft,[e("div",pt,[e("span",null,i(n.__("Customer Account")),1),e("span",null,i(n.nsCurrency(r.order.customer.account_amount)),1)])])]),e("div",_t,[e("div",ht,[r.order.payment_status!=="paid"?(l(),a("div",mt,[e("h3",bt,i(n.__("Payment")),1),e("div",yt,[(l(!0),a(x,null,w(o.fields,(c,v)=>(l(),k(y,{field:c,key:v},null,8,["field"]))),128)),e("div",vt,i(n.nsCurrency(o.inputValue)),1),b(d,{floating:!0,onNext:t[0]||(t[0]=c=>n.submitPayment(c)),onChanged:t[1]||(t[1]=c=>n.updateValue(c)),value:o.inputValue},null,8,["value"])])])):_("",!0),r.order.payment_status==="paid"?(l(),a("div",xt,[e("h3",wt,i(n.__("No payment possible for paid order.")),1)])):_("",!0)]),e("div",gt,[e("h3",Pt,i(n.__("Payment History")),1),e("ul",null,[(l(!0),a(x,null,w(r.order.payments,c=>(l(),a("li",{key:c.id,class:"p-2 flex items-center justify-between text-shite border elevation-surface mb-2"},[e("span",kt,[e("a",{href:"javascript:void(0)",onClick:v=>n.printPaymentReceipt(c),class:"m-1 rounded-full hover:bg-info-tertiary hover:text-white flex items-center justify-center h-8 w-8"},t[2]||(t[2]=[e("i",{class:"las la-print"},null,-1)]),8,Ct),S(" "+i(n.paymentsLabels[c.identifier]||n.__("Unknown")),1)]),e("span",null,i(n.nsCurrency(c.value)),1)]))),128))])])])],64)}const St=Q(st,[["render",jt]]),Qt={name:"ns-orders-refund-popup",props:["popup"],data(){return{order:null,refunds:[],view:"summary",previewed:null,loaded:!1,options:systemOptions,systemUrls,print:new D({urls:systemUrls,options:systemOptions})}},methods:{__:u,nsCurrency:U,popupCloser:A,popupResolver:O,toggleProductView(s){this.view="details",this.previewed=s},loadOrderRefunds(){nsHttpClient.get(`/api/orders/${this.order.id}/refunds`).subscribe(s=>{this.loaded=!0,this.refunds=s.refunds},s=>{m.error(s.message)})},close(){this.popup.close()},printRefundReceipt(s){this.print.process(s.id,"refund")}},mounted(){this.order=this.popup.params.order,this.popupCloser(),this.loadOrderRefunds()}},Vt={class:"shadow-lg w-95vw h-95vh md:w-3/5-screen md:h-[60vh] ns-box flex flex-col overflow-hidden"},qt={class:"border-b p-2 flex items-center justify-between ns-box-header"},Ut={class:"flex"},At={class:"overflow-auto flex-auto ns-box-body"},Ft={key:0,class:"flex h-full w-full items-center justify-center"},Ot={key:1,class:"flex h-full w-full items-center flex-col justify-center"},Dt={class:"md:w-80 text-sm text-fontcolor-soft text-center"},Tt={class:"w-full md:flex-auto p-2"},Rt={class:"font-semibold mb-1"},$t={class:"flex -mx-1 text-sm text-font"},Lt={class:"px-1"},It={class:"px-1"},Mt=["onClick"],Yt=["onClick"],Nt={class:"w-full md:flex-auto p-2"},Bt={class:"font-semibold mb-1"},Wt={class:"flex -mx-1 text-sm text-font"},Gt={class:"px-1"},Ht={class:"px-1"},Et={class:"px-1"};function zt(s,t,r,f,o,n){const y=h("ns-close-button"),d=h("ns-spinner");return l(),a("div",Vt,[e("div",qt,[e("h3",null,i(n.__("Order Refunds")),1),e("div",Ut,[o.view==="details"?(l(),a("div",{key:0,onClick:t[0]||(t[0]=c=>o.view="summary"),class:"flex items-center justify-center cursor-pointer rounded-full px-3 border ns-inset-button mr-1"},i(n.__("Go Back")),1)):_("",!0),b(y,{onClick:t[1]||(t[1]=c=>n.close())})])]),e("div",At,[o.view==="summary"?(l(),a(x,{key:0},[o.loaded?_("",!0):(l(),a("div",Ft,[b(d,{size:"24"})])),o.loaded&&o.refunds.length===0?(l(),a("div",Ot,[t[2]||(t[2]=e("i",{class:"las la-laugh-wink text-5xl"},null,-1)),e("p",Dt,i(n.__("No refunds made so far. Good news right?")),1)])):_("",!0),o.loaded&&o.refunds.length>0?(l(!0),a(x,{key:2},w(o.refunds,c=>(l(),a("div",{class:"border-b border-box-edge flex flex-col md:flex-row",key:c.id},[e("div",Tt,[e("h3",Rt,i(o.order.code),1),e("div",null,[e("ul",$t,[e("li",Lt,i(n.__("Total"))+" : "+i(n.nsCurrency(c.total)),1),e("li",It,i(n.__("By"))+" : "+i(c.author.username),1)])])]),e("div",{onClick:v=>n.toggleProductView(c),class:"w-full md:w-16 cursor-pointer hover:bg-info-secondary hover:border-info-primary hover:text-white text-lg flex items-center justify-center border-box-edge md:border-l"},t[3]||(t[3]=[e("i",{class:"las la-eye"},null,-1)]),8,Mt),e("div",{onClick:v=>n.printRefundReceipt(c),class:"w-full md:w-16 cursor-pointer hover:bg-info-secondary hover:border-info-primary hover:text-white text-lg flex items-center justify-center border-box-edge md:border-l"},t[4]||(t[4]=[e("i",{class:"las la-print"},null,-1)]),8,Yt)]))),128)):_("",!0)],64)):_("",!0),o.view==="details"?(l(!0),a(x,{key:1},w(o.previewed.refunded_products,c=>(l(),a("div",{class:"border-b border-box-edge flex flex-col md:flex-row",key:c.id},[e("div",Nt,[e("h3",Bt,i(c.product.name),1),e("div",null,[e("ul",Wt,[e("li",Gt,i(n.__("Condition"))+" : "+i(c.condition),1),e("li",Ht,i(n.__("Quantity"))+" : "+i(c.quantity),1),e("li",Et,i(n.__("Total"))+" : "+i(n.nsCurrency(c.total_price)),1)])])])]))),128)):_("",!0)])])}const K=Q(Qt,[["render",zt]]),Kt={props:["order"],data(){return{processingStatuses,deliveryStatuses,labels:new Y,showProcessingSelect:!1,showDeliverySelect:!1,systemUrls}},mounted(){},methods:{__:u,nsCurrency:U,submitProcessingChange(){V.show(j,{title:u("Would you proceed ?"),message:u("The processing status of the order will be changed. Please confirm your action."),onAction:s=>{s&&C.post(`/api/orders/${this.order.id}/processing`,{process_status:this.order.process_status}).subscribe({next:t=>{this.showProcessingSelect=!1,m.success(t.message)},error:t=>{m.error(t.message||u("Unexpected error occurred."))}})}})},openRefunds(){try{const s=new Promise((t,r)=>{const f=this.order;V.show(K,{order:f,resolve:t,reject:r})})}catch{}},submitDeliveryStatus(){V.show(j,{title:u("Would you proceed ?"),message:u("The delivery status of the order will be changed. Please confirm your action."),onAction:s=>{s&&C.post(`/api/orders/${this.order.id}/delivery`,{delivery_status:this.order.delivery_status}).subscribe({next:t=>{this.showDeliverySelect=!1,m.success(t.message)},error:t=>{m.error(t.message||u("Unexpected error occurred."))}})}})}}},Jt={class:"-mx-4 flex flex-wrap"},Xt={class:"flex-auto"},Zt={class:"w-full mb-2 flex-wrap flex"},es={class:"w-full mb-2 px-4"},ts={class:"font-semibold text-fontcolor-soft pb-2 border-b border-info-primary"},ss={class:"mb-2 w-full md:w-1/2 px-4"},is={class:"elevation-surface border p-2 flex justify-between items-start"},rs={class:"text-semibold text-font"},os={class:"font-semibold text-fontcolor-soft"},ls={class:"mb-2 w-full md:w-1/2 px-4"},ds={class:"p-2 flex justify-between items-start text-fontcolor elevation-surface error border"},as={class:"text-semibold"},us={class:""},cs={key:0,class:"ml-1"},fs={key:1,class:"ml-1"},ps={class:"font-semibold text-font"},_s={class:"mb-2 w-full md:w-1/2 px-4"},hs={class:"p-2 flex justify-between items-start elevation-surface border"},ms={class:"text-semibold text-font"},bs={class:"font-semibold text-fontcolor-soft"},ys={class:"mb-2 w-full md:w-1/2 px-4"},vs={class:"p-2 flex justify-between items-start text-fontcolor elevation-surface error border"},xs={class:"text-semibold"},ws={class:"font-semibold text-font"},gs={class:"mb-2 w-full md:w-1/2 px-4"},Ps={class:"p-2 flex justify-between items-start border ns-notice success"},ks={class:"text-semibold"},Cs={class:"font-semibold text-font"},js={class:"mb-2 w-full md:w-1/2 px-4"},Ss={class:"p-2 flex justify-between items-start text-fontcolor elevation-surface info border"},Qs={class:"text-semibold"},Vs={class:"font-semibold"},qs={class:"mb-2 w-full md:w-1/2 px-4"},Us={class:"p-2 flex justify-between items-start text-fontcolor elevation-surface error border"},As={class:"text-semibold"},Fs={class:"font-semibold"},Os={class:"mb-2 w-full md:w-1/2 px-4"},Ds={class:"p-2 flex justify-between items-start elevation-surface border"},Ts={class:"text-semibold"},Rs={class:"font-semibold"},$s={class:"px-4 w-full md:w-1/2 lg:w-2/4 mb-2"},Ls={class:"mb-2"},Is={class:"font-semibold text-fontcolor-soft pb-2 border-b border-info-primary"},Ms={class:"mb-2 p-2 flex justify-between items-start elevation-surface border"},Ys={class:"text-semibold text-font"},Ns={key:0,class:"font-semibold text-fontcolor-soft"},Bs=["href"],Ws={class:"mb-2 p-2 flex justify-between items-start elevation-surface border"},Gs={class:"text-semibold text-font"},Hs={class:"font-semibold text-fontcolor-soft"},Es={class:"mb-2 p-2 flex justify-between items-start elevation-surface border"},zs={class:"text-semibold text-font"},Ks={class:"font-semibold text-fontcolor-soft mt-2 md:mt-0 w-full md:w-auto"},Js={class:"w-full text-center"},Xs={key:0,class:"flex-auto flex"},Zs={class:"ns-select flex items-center justify-center"},en=["value"],tn={class:"pl-2 flex"},sn={class:"mb-2 p-2 flex flex-col md:flex-row justify-between items-center elevation-surface border"},nn={class:"text-semibold text-font"},rn={class:"font-semibold text-fontcolor-soft mt-2 md:mt-0 w-full md:w-auto"},on={class:"w-full text-center"},ln={key:0,class:"flex-auto flex"},dn={class:"ns-select flex items-center justify-center"},an=["value"],un={class:"pl-2 flex"},cn={class:"mb-2 p-2 flex justify-between items-start elevation-surface border"},fn={class:"text-semibold text-font"},pn={class:"font-semibold text-fontcolor-soft"},_n={class:"px-4 w-full md:w-1/2 lg:w-2/4 mb-2"},hn={class:"mb-2"},mn={class:"font-semibold text-fontcolor-soft pb-2 border-b border-info-primary"},bn={class:"text-semibold text-font"},yn={class:"text-fontcolor-soft text-sm"},vn={class:"font-semibold text-fontcolor-soft"},xn={class:"mb-2"},wn={class:"font-semibold text-fontcolor-soft pb-2 border-b border-info-primary flex justify-between"},gn={class:"text-semibold text-font"},Pn={class:"text-fontcolor-soft text-sm"},kn={class:"font-semibold text-fontcolor-soft"};function Cn(s,t,r,f,o,n){const y=h("ns-close-button");return l(),a("div",Jt,[e("div",Xt,[e("div",Zt,[e("div",es,[e("h3",ts,i(n.__("Payment Summary")),1)]),e("div",ss,[e("div",is,[e("div",null,[e("h4",rs,i(n.__("Sub Total")),1)]),e("div",os,i(n.nsCurrency(r.order.subtotal)),1)])]),e("div",ls,[e("div",ds,[e("div",null,[e("h4",as,[e("span",us,i(n.__("Discount")),1),r.order.discount_type==="percentage"?(l(),a("span",cs,"("+i(r.order.discount_percentage)+"%)",1)):_("",!0),r.order.discount_type==="flat"?(l(),a("span",fs,"(Flat)")):_("",!0)])]),e("div",ps,i(n.nsCurrency(r.order.discount)),1)])]),e("div",_s,[e("div",hs,[e("div",null,[e("span",ms,i(n.__("Shipping")),1)]),e("div",bs,i(n.nsCurrency(r.order.shipping)),1)])]),e("div",ys,[e("div",vs,[e("div",null,[e("span",xs,i(n.__("Coupons")),1)]),e("div",ws,i(n.nsCurrency(r.order.total_coupons)),1)])]),e("div",gs,[e("div",Ps,[e("div",null,[e("span",ks,i(n.__("Total")),1)]),e("div",Cs,i(n.nsCurrency(r.order.total)),1)])]),e("div",js,[e("div",Ss,[e("div",null,[e("span",Qs,i(n.__("Taxes")),1)]),e("div",Vs,i(n.nsCurrency(r.order.tax_value)),1)])]),e("div",qs,[e("div",Us,[e("div",null,[e("span",As,i(n.__("Change")),1)]),e("div",Fs,i(n.nsCurrency(r.order.change)),1)])]),e("div",Os,[e("div",Ds,[e("div",null,[e("span",Ts,i(n.__("Paid")),1)]),e("div",Rs,i(n.nsCurrency(r.order.tendered)),1)])])])]),e("div",$s,[e("div",Ls,[e("h3",Is,i(n.__("Order Status")),1)]),e("div",Ms,[e("div",null,[e("h4",Ys,[e("span",null,i(n.__("Customer")),1)])]),r.order?(l(),a("div",Ns,[e("a",{class:"border-b border-dashed border-info-primary",href:o.systemUrls.customer_edit_url.replace("#customer",r.order.customer.id),target:"_blank",rel:"noopener noreferrer"},i(r.order.customer.first_name)+" "+i(r.order.customer.last_name),9,Bs)])):_("",!0)]),e("div",Ws,[e("div",null,[e("h4",Gs,[e("span",null,i(n.__("Type")),1)])]),e("div",Hs,i(o.labels.getTypeLabel(r.order.type)),1)]),e("div",Es,[e("div",null,[e("h4",zs,[e("span",null,i(n.__("Delivery Status")),1)])]),e("div",Ks,[e("div",Js,[o.showDeliverySelect?_("",!0):(l(),a("span",{key:0,onClick:t[0]||(t[0]=d=>o.showDeliverySelect=!0),class:"font-semibold text-fontcolor-soft border-b border-info-primary cursor-pointer border-dashed"},i(o.labels.getDeliveryStatus(r.order.delivery_status)),1))]),o.showDeliverySelect?(l(),a("div",Xs,[e("div",Zs,[R(e("select",{ref:"process_status",class:"flex-auto border-info-primary rounded-lg","onUpdate:modelValue":t[1]||(t[1]=d=>r.order.delivery_status=d)},[(l(!0),a(x,null,w(o.deliveryStatuses,(d,c)=>(l(),a("option",{key:c,value:d.value},i(d.label),9,en))),128))],512),[[B,r.order.delivery_status]])]),e("div",tn,[b(y,{onClick:t[2]||(t[2]=d=>o.showDeliverySelect=!1)}),e("button",{onClick:t[3]||(t[3]=d=>n.submitDeliveryStatus(r.order)),class:"bg-success-primary text-white rounded-full px-2 py-1"},i(n.__("Save")),1)])])):_("",!0)])]),e("div",sn,[e("div",null,[e("h4",nn,[e("span",null,i(n.__("Processing Status")),1)])]),e("div",rn,[e("div",on,[o.showProcessingSelect?_("",!0):(l(),a("span",{key:0,onClick:t[4]||(t[4]=d=>o.showProcessingSelect=!0),class:"border-b border-info-primary cursor-pointer border-dashed"},i(o.labels.getProcessingStatus(r.order.process_status)),1))]),o.showProcessingSelect?(l(),a("div",ln,[e("div",dn,[R(e("select",{ref:"process_status",class:"flex-auto border-info-primary rounded-lg","onUpdate:modelValue":t[5]||(t[5]=d=>r.order.process_status=d)},[(l(!0),a(x,null,w(o.processingStatuses,(d,c)=>(l(),a("option",{key:c,value:d.value},i(d.label),9,an))),128))],512),[[B,r.order.process_status]])]),e("div",un,[b(y,{onClick:t[6]||(t[6]=d=>o.showProcessingSelect=!1)}),e("button",{onClick:t[7]||(t[7]=d=>n.submitProcessingChange(r.order)),class:"bg-success-primary text-white rounded-full px-2 py-1"},i(n.__("Save")),1)])])):_("",!0)])]),e("div",cn,[e("div",null,[e("h4",fn,[e("span",null,i(n.__("Payment Status")),1)])]),e("div",pn,i(o.labels.getPaymentStatus(r.order.payment_status)),1)])]),e("div",_n,[e("div",hn,[e("h3",mn,i(n.__("Products")),1)]),(l(!0),a(x,null,w(r.order.products,d=>(l(),a("div",{key:d.id,class:"p-2 flex justify-between items-start elevation-surface border mb-6"},[e("div",null,[e("h4",bn,i(d.name)+" (x"+i(d.quantity)+")",1),e("p",yn,i(d.unit.name||"N/A"),1)]),e("div",vn,i(n.nsCurrency(d.total_price)),1)]))),128)),e("div",xn,[e("h3",wn,[e("span",null,i(n.__("Refunded Products")),1),e("a",{href:"javascript:void(0)",onClick:t[8]||(t[8]=d=>n.openRefunds()),class:"border-b border-info-primary border-dashed"},i(n.__("All Refunds")),1)])]),(l(!0),a(x,null,w(r.order.refunded_products,(d,c)=>(l(),a("div",{key:c,class:"p-2 flex justify-between items-start elevation-surface border mb-6"},[e("div",null,[e("h4",gn,i(d.order_product.name)+" (x"+i(d.quantity)+")",1),e("p",Pn,[S(i(d.unit.name||"N/A")+" | ",1),e("span",{class:T(["rounded-full px-2",d.condition==="damaged"?"bg-error-tertiary text-white":"bg-info-tertiary text-white"])},i(d.condition),3)])]),e("div",kn,i(n.nsCurrency(d.total_price)),1)]))),128))])])}const jn=Q(Kt,[["render",Cn]]),Sn={name:"ns-order-instalments-payment",props:["popup"],components:{nsNotice:Z},data(){return{paymentTypes,fields:[{type:"select",name:"payment_type",description:u("Select the payment type that must apply to the current order."),label:u("Payment Type"),validation:"required",options:paymentTypes}],print:new D({urls:systemUrls,options:systemOptions}),validation:new F,order:null,instalment:null}},methods:{__:u,popupResolver:O,popupCloser:A,close(){this.popupResolver(!1)},updateInstalmentAsDue(s){nsHttpClient.put(`/api/orders/${this.order.id}/instalments/${this.instalment.id}/`,{instalment:{date:ns.date.moment.format("YYYY-MM-DD HH:mm:ss")}}).subscribe({next:t=>{this.submitPayment()},error:t=>{m.error(t.message||u("An unexpected error has occurred"))}})},submitPayment(){if(!this.validation.validateFields(this.fields))return m.error(__m("The form is not valid.")).subcribe();nsHttpClient.post(`/api/orders/${this.order.id}/instalments/${this.instalment.id}/pay`,{...this.validation.extractFields(this.fields)}).subscribe({next:s=>{this.popupResolver(!0),this.print.exec(s.data.payment.id,"payment"),m.success(s.message)},error:s=>{s.status==="error"&&Popup.show(j,{title:u("Update Instalment Date"),message:u("Would you like to mark that instalment as due today ? If you confirm the instalment will be marked as paid."),onAction:t=>{t&&this.updateInstalmentAsDue(this.instalment)}}),m.error(s.message||u("An unexpected error has occurred"))}})}},mounted(){this.popupCloser(),this.order=this.popup.params.order,this.instalment=this.popup.params.instalment,this.fields=this.validation.createFields(this.fields)}},Qn={class:"shadow-lg ns-box w-95vw md:w-2/3-screen lg:w-1/3-screen"},Vn={class:"p-2 flex justify-between border-b items-center"},qn={class:"p-2 ns-box-body"},Un={class:"border-t ns-box-footer p-2 flex justify-end"};function An(s,t,r,f,o,n){const y=h("ns-close-button"),d=h("ns-notice"),c=h("ns-field"),v=h("ns-button");return l(),a("div",Qn,[e("div",Vn,[e("h3",null,i(n.__("Payment Method")),1),e("div",null,[b(y,{onClick:t[0]||(t[0]=p=>n.close())})])]),e("div",qn,[b(d,{color:"info",class:"py-2 p-4 text-center border text-fontcolor rounded-lg"},{default:P(()=>[S(i(n.__("Before submitting the payment, choose the payment type used for that order.")),1)]),_:1}),t[2]||(t[2]=e("br",null,null,-1)),(l(!0),a(x,null,w(o.fields,(p,g)=>(l(),k(c,{key:g,field:p},null,8,["field"]))),128))]),e("div",Un,[b(v,{onClick:t[1]||(t[1]=p=>n.submitPayment()),type:"info"},{default:P(()=>[S(i(n.__("Submit Payment")),1)]),_:1})])])}const Fn=Q(Sn,[["render",An]]),On={props:["order"],name:"ns-order-instalments",data(){return{labels:new Y,original:[],instalments:[],print:new D({urls:systemUrls,options:systemOptions,type:"payment"})}},mounted(){this.loadInstalments()},computed:{totalInstalments(){return this.instalments.length>0?this.instalments.map(s=>s.amount).reduce((s,t)=>parseFloat(s)+parseFloat(t)):0}},methods:{__:u,nsCurrency:U,loadInstalments(){C.get(`/api/orders/${this.order.id}/instalments`).subscribe(s=>{this.original=s,this.instalments=s.map(t=>(t.price_clicked=!1,t.date_clicked=!1,t.date=moment(t.date).format("YYYY-MM-DD"),t))})},showReceipt(s){if(s.payment_id===null)return m.error(u("This instalment doesn't have any payment attached."));this.print.process(s.payment_id,"payment")},addInstalment(){this.instalments.push({date:ns.date.moment.format("YYYY-MM-DD"),amount:this.order.total-this.totalInstalments,paid:!1})},createInstalment(s){Popup.show(j,{title:u("Confirm Your Action"),message:u("Would you like to create this instalment ?"),onAction:t=>{t&&C.post(`/api/orders/${this.order.id}/instalments`,{instalment:s}).subscribe({next:r=>{this.loadInstalments(),m.success(r.message)},error:r=>{m.error(r.message||u("An unexpected error has occurred"))}})}})},deleteInstalment(s){Popup.show(j,{title:u("Confirm Your Action"),message:u("Would you like to delete this instalment ?"),onAction:t=>{t&&C.delete(`/api/orders/${this.order.id}/instalments/${s.id}`).subscribe({next:r=>{const f=this.instalments.indexOf(s);this.instalments.splice(f,1),m.success(r.message)},error:r=>{m.error(r.message||u("An unexpected error has occurred"))}})}})},async markAsPaid(s){try{const t=await new Promise((r,f)=>{Popup.show(Fn,{order:this.order,instalment:s,resolve:r,reject:f})});this.loadInstalments()}catch{}},togglePriceEdition(s){s.paid||(s.price_clicked=!s.price_clicked,this.$forceUpdate(),s.price_clicked&&setTimeout(()=>{this.$refs.amount[0].select()},100))},updateInstalment(s){Popup.show(j,{title:u("Confirm Your Action"),message:u("Would you like to update that instalment ?"),onAction:t=>{t&&C.put(`/api/orders/${this.order.id}/instalments/${s.id}`,{instalment:s}).subscribe({next:r=>{m.success(r.message)},error:r=>{m.error(r.message||u("An unexpected error has occurred"))}})}})},toggleDateEdition(s){s.paid||(s.date_clicked=!s.date_clicked,this.$forceUpdate(),s.date_clicked&&setTimeout(()=>{this.$refs.date[0].select()},200))}}},Dn={class:"-mx-4 flex-auto flex flex-wrap"},Tn={class:"flex flex-auto"},Rn={class:"w-full mb-2 flex-wrap"},$n={class:"w-full mb-2 px-4"},Ln={class:"font-semibold text-fontcolor-soft pb-2 border-b border-info-primary"},In={class:"px-4"},Mn={class:"border-table-th-edge border-t text-font"},Yn={class:"p-2"},Nn=["onClick"],Bn={key:1},Wn=["onBlur","onUpdate:modelValue"],Gn={class:"flex items-center"},Hn={class:"flex items-center px-2 h-full border-r"},En=["onClick"],zn={key:1},Kn=["onUpdate:modelValue","onBlur"],Jn={key:0,class:"w-36 justify-center flex items-center px-2 h-full border-r"},Xn={class:"px-2"},Zn={class:"px-2"},ei={class:"px-2"},ti={key:1,class:"w-36 justify-center flex items-center px-2 h-full border-r"},si={class:"px-2"},ni={class:"ns-button info"},ii=["onClick"],ri={key:2,class:"w-36 justify-center flex items-center px-2 h-full"},oi={class:"ns-button info"},li=["onClick"],di={class:"flex justify-between p-2 border-r border-b border-l elevation-surface"},ai={class:"flex items-center justify-center"},ui={class:"ml-1 text-sm"},ci={class:"-mx-2 flex flex-wrap items-center"},fi={class:"px-2"},pi={class:"px-2"},_i={class:"ns-button info"};function hi(s,t,r,f,o,n){const y=h("ns-icon-button");return l(),a("div",Dn,[e("div",Tn,[e("div",Rn,[e("div",$n,[e("h3",Ln,i(n.__("Instalments")),1)]),e("div",In,[e("ul",Mn,[(l(!0),a(x,null,w(o.instalments,d=>(l(),a("li",{class:T([d.paid?"success":"info","border-b border-l flex justify-between elevation-surface"]),key:d.id},[e("span",Yn,[d.date_clicked?_("",!0):(l(),a("span",{key:0,onClick:c=>n.toggleDateEdition(d)},i(d.date),9,Nn)),d.date_clicked?(l(),a("span",Bn,[R(e("input",{onBlur:c=>n.toggleDateEdition(d),"onUpdate:modelValue":c=>d.date=c,type:"date",ref_for:!0,ref:"date",class:"border border-info-primary rounded"},null,40,Wn),[[W,d.date]])])):_("",!0)]),e("div",Gn,[e("div",Hn,[d.price_clicked?_("",!0):(l(),a("span",{key:0,onClick:c=>n.togglePriceEdition(d)},i(n.nsCurrency(d.amount)),9,En)),d.price_clicked?(l(),a("span",zn,[R(e("input",{ref_for:!0,ref:"amount","onUpdate:modelValue":c=>d.amount=c,onBlur:c=>n.togglePriceEdition(d),type:"text",class:"border border-info-primary p-1"},null,40,Kn),[[W,d.amount]])])):_("",!0)]),!d.paid&&d.id?(l(),a("div",Jn,[e("div",Xn,[b(y,{type:"success",onClick:c=>n.markAsPaid(d),className:"la-money-bill-wave-alt"},null,8,["onClick"])]),e("div",Zn,[b(y,{type:"info",onClick:c=>n.updateInstalment(d),className:"la-save"},null,8,["onClick"])]),e("div",ei,[b(y,{type:"error",onClick:c=>n.deleteInstalment(d),className:"la-trash-alt"},null,8,["onClick"])])])):_("",!0),!d.paid&&!d.id?(l(),a("div",ti,[e("div",si,[e("div",ni,[e("button",{onClick:c=>n.createInstalment(d),class:"px-3 py-1 rounded-full"},[t[1]||(t[1]=e("i",{class:"las la-plus"},null,-1)),S(" "+i(n.__("Create")),1)],8,ii)])])])):_("",!0),d.paid?(l(),a("div",ri,[e("div",oi,[e("button",{onClick:c=>n.showReceipt(d),class:"px-3 text-xs py-1 rounded-full"},[t[2]||(t[2]=e("i",{class:"las la-print"},null,-1)),S(" "+i(n.__("Receipt")),1)],8,li)])])):_("",!0)])],2))),128)),e("li",di,[e("div",ai,[e("span",null,i(n.__("Total :"))+" "+i(n.nsCurrency(r.order.total)),1),e("span",ui," ("+i(n.__("Remaining :"))+" "+i(n.nsCurrency(r.order.total-n.totalInstalments))+") ",1)]),e("div",ci,[e("span",fi,i(n.__("Instalments:"))+" "+i(n.nsCurrency(n.totalInstalments)),1),e("span",pi,[e("div",_i,[e("button",{onClick:t[0]||(t[0]=d=>n.addInstalment()),class:"rounded-full px-3 py-1"},i(n.__("Add Instalment")),1)])])])])])])])])])}const mi=Q(On,[["render",hi]]),bi={name:"ns-orders-preview-popup",props:["popup"],data(){return{active:"details",order:new Object,rawOrder:new Object,products:[],payments:[],options:null,print:new D({urls:systemUrls,options:systemOptions}),settings:null,orderDetailLoaded:!1}},components:{nsOrderRefund:tt,nsOrderPayment:St,nsOrderDetails:jn,nsOrderInstalments:mi},computed:{isVoidable(){return["paid","partially_paid","unpaid"].includes(this.order.payment_status)},isDeleteAble(){return["hold"].includes(this.order.payment_status)}},methods:{__:u,popupResolver:O,popupCloser:A,nsCurrency:U,closePopup(s=!1){this.popupResolver(s)},setActive(s){this.active=s},printOrder(){this.print.process(this.order.id,"sale")},refresh(){this.loadOrderDetails(this.order.id)},loadOrderDetails(s){this.orderDetailLoaded=!1,ie([C.get(`/api/orders/${s}`),C.get(`/api/orders/${s}/products`),C.get(`/api/orders/${s}/payments`)]).subscribe(t=>{this.orderDetailLoaded=!0,this.order=t[0],this.products=t[1],this.payments=t[2]})},deleteOrder(){Popup.show(j,{title:u("Confirm Your Action"),message:u("Would you like to delete this order"),onAction:s=>{s&&C.delete(`/api/orders/${this.order.id}`).subscribe({next:t=>{m.success(t.message),this.refreshCrudTable(),this.closePopup(!0)},error:t=>{m.error(t.message)}})}})},voidOrder(){try{const s=new Promise((t,r)=>{Popup.show(z,{resolve:t,reject:r,title:u("Confirm Your Action"),message:u("The current order will be void. This action will be recorded. Consider providing a reason for this operation"),onAction:f=>{f!==!1&&C.post(`/api/orders/${this.order.id}/void`,{reason:f}).subscribe({next:o=>{m.success(o.message),this.refreshCrudTable(),this.closePopup(!0)},error:o=>{m.error(o.message)}})}})})}catch(s){console.log(s)}},refreshCrudTable(){this.popup.params.component.$emit("updated",!0)}},watch:{active(){this.active==="details"&&this.loadOrderDetails(this.rawOrder.id)}},mounted(){this.rawOrder=this.popup.params.order,this.options=systemOptions,this.urls=systemUrls,this.loadOrderDetails(this.rawOrder.id),this.popupCloser()}},yi={class:"h-95vh w-95vw md:h-[80vh] md:w-6/7-screen overflow-hidden shadow-xl ns-box flex flex-col"},vi={class:"border-b ns-box-header p-3 flex items-center justify-between"},xi={class:"p-2 ns-box-body overflow-hidden flex flex-auto"},wi={key:1,class:"h-full w-full flex items-center justify-center"},gi={key:0,class:"p-2 flex justify-between border-t ns-box-footer"};function Pi(s,t,r,f,o,n){const y=h("ns-close-button"),d=h("ns-order-details"),c=h("ns-tabs-item"),v=h("ns-order-payment"),p=h("ns-order-refund"),g=h("ns-order-instalments"),J=h("ns-tabs"),X=h("ns-spinner"),$=h("ns-button");return l(),a("div",yi,[e("div",vi,[e("div",null,[e("h3",null,i(n.__("Order Options")),1)]),e("div",null,[b(y,{onClick:t[0]||(t[0]=q=>n.closePopup(!0))})])]),e("div",xi,[o.order.id?(l(),k(J,{key:0,active:o.active,onActive:t[5]||(t[5]=q=>n.setActive(q))},{default:P(()=>[b(c,{label:n.__("Details"),identifier:"details",class:"overflow-y-auto"},{default:P(()=>[o.order?(l(),k(d,{key:0,order:o.order},null,8,["order"])):_("",!0)]),_:1},8,["label"]),b(c,{visible:!["order_void","hold","refunded","partially_refunded"].includes(o.order.payment_status),label:n.__("Payments"),identifier:"payments"},{default:P(()=>[o.order?(l(),k(v,{key:0,onChanged:t[1]||(t[1]=q=>n.refresh()),order:o.order},null,8,["order"])):_("",!0)]),_:1},8,["visible","label"]),b(c,{visible:!["order_void","hold","refunded"].includes(o.order.payment_status),label:n.__("Refund & Return"),identifier:"refund"},{default:P(()=>[o.order?(l(),k(p,{key:0,onLoadTab:t[2]||(t[2]=q=>n.setActive(q)),onChanged:t[3]||(t[3]=q=>n.refresh()),order:o.order},null,8,["order"])):_("",!0)]),_:1},8,["visible","label"]),b(c,{visible:["partially_paid","unpaid"].includes(o.order.payment_status)&&o.order.support_instalments,label:n.__("Installments"),identifier:"instalments"},{default:P(()=>[o.order?(l(),k(g,{key:0,onChanged:t[4]||(t[4]=q=>n.refresh()),order:o.order},null,8,["order"])):_("",!0)]),_:1},8,["visible","label"])]),_:1},8,["active"])):_("",!0),o.order.id?_("",!0):(l(),a("div",wi,[b(X)]))]),o.orderDetailLoaded?(l(),a("div",gi,[e("div",null,[n.isVoidable?(l(),k($,{key:0,onClick:t[6]||(t[6]=q=>n.voidOrder()),type:"error"},{default:P(()=>[t[9]||(t[9]=e("i",{class:"las la-ban"},null,-1)),S(" "+i(n.__("Void")),1)]),_:1})):_("",!0),n.isDeleteAble?(l(),k($,{key:1,onClick:t[7]||(t[7]=q=>n.deleteOrder()),type:"error"},{default:P(()=>[t[10]||(t[10]=e("i",{class:"las la-trash"},null,-1)),S(" "+i(n.__("Delete")),1)]),_:1})):_("",!0)]),e("div",null,[b($,{onClick:t[8]||(t[8]=q=>n.printOrder()),type:"info"},{default:P(()=>[t[11]||(t[11]=e("i",{class:"las la-print"},null,-1)),S(" "+i(n.__("Print")),1)]),_:1})])])):_("",!0)])}const ki=Q(bi,[["render",Pi]]),Ci={name:"ns-procurement-quantity",props:["popup"],data(){return{finalValue:1,virtualStock:null,allSelected:!0,isLoading:!1,keys:[...[1,2,3].map(s=>({identifier:s,value:s})),...[4,5,6].map(s=>({identifier:s,value:s})),...[7,8,9].map(s=>({identifier:s,value:s})),{identifier:"backspace",icon:"la-backspace"},{identifier:0,value:0},{identifier:"next",icon:"la-share"}]}},mounted(){this.popup.params.quantity&&(this.finalValue=this.popup.params.quantity),document.addEventListener("keyup",this.handleKeyPress)},unmounted(){document.removeEventListener("keypress",this.handleKeyPress)},methods:{__:u,handleKeyPress(s){s.keyCode===13&&this.inputValue({identifier:"next"})},closePopup(){this.popup.params.reject(!1),this.popup.close()},inputValue(s){if(s.identifier==="next"){const{product:t,data:r}=this.popup.params,f=parseFloat(this.finalValue);if(f===0)return m.error(u("Please provide a quantity"));this.resolve({quantity:f})}else s.identifier==="backspace"?this.allSelected?(this.finalValue=0,this.allSelected=!1):(this.finalValue=this.finalValue.toString(),this.finalValue=this.finalValue.substr(0,this.finalValue.length-1)||0):this.allSelected?(this.finalValue=s.value,this.finalValue=parseFloat(this.finalValue),this.allSelected=!1):(this.finalValue+=""+s.value,this.finalValue=parseFloat(this.finalValue))},resolve(s){this.popup.params.resolve(s),this.popup.close()}}},ji={class:"ns-box shadow min-h-[40vh] w-3/4-screen md:w-3/5-screen lg:w-3/5-screen xl:w-2/5-screen relative"},Si={class:"flex-shrink-0 flex p-2 border-b ns-box-header justify-between items-center"},Qi={class:"text-xl font-bold text-fontcolor text-center"},Vi={id:"screen",class:"h-16 ns-box-body flex items-center justify-center"},qi={class:"font-bold text-3xl"},Ui={id:"numpad",class:"grid grid-flow-row grid-cols-3 grid-rows-3"},Ai=["onClick"],Fi={key:0};function Oi(s,t,r,f,o,n){const y=h("ns-close-button");return l(),a("div",ji,[e("div",Si,[e("h1",Qi,i(n.__("Define Quantity")),1),e("div",null,[b(y,{onClick:t[0]||(t[0]=d=>n.closePopup())})])]),e("div",Vi,[e("h1",qi,i(o.finalValue),1)]),e("div",Ui,[(l(!0),a(x,null,w(o.keys,(d,c)=>(l(),a("div",{onClick:v=>n.inputValue(d),key:c,class:"text-xl font-bold border ns-numpad-key h-24 flex items-center justify-center cursor-pointer"},[d.value!==void 0?(l(),a("span",Fi,i(d.value),1)):_("",!0),d.icon?(l(),a("i",{key:1,class:T(["las",d.icon])},null,2)):_("",!0)],8,Ai))),128))])])}const Di=Q(Ci,[["render",Oi]]),Ti={name:"ns-products-convertion",props:["popup","unitQuantity","product"],data(){return{unitQuantities:[],isLoading:!1,unitPair:{from:{unit:{},unitQuantity:{},selected:!0,quantity:0,realQuantity:0,fields:[{label:u("Assigned Unit"),name:"assigned_unit",value:"",type:"select",options:[]}]},to:{unit:{},unitQuantity:{},selected:!1,quantity:0,fields:[{label:u("Assigned Unit"),name:"assigned_unit",value:"",type:"select",options:[]}]}},selected:""}},mounted(){this.loadProductQuantities(),console.log(this)},methods:{__:u,async submitConvertion(){if(this.unitPair.from.quantity===0)return m.error(u("The quantity should be greater than 0"));if(Math.floor(this.unitPair.to.quantity)===0)return m.error(u(`The provided quantity can't result in any convertion for unit "{destination}"`).replace("{destination}",this.unitPair.to.unit.name)).subscribe();if(this.unitPair.from.quantity!==this.unitPair.from.realQuantity)try{const s=await new Promise((t,r)=>{V.show(j,{title:u("Conversion Warning"),message:u("Only {quantity}({source}) can be converted to {destinationCount}({destination}). Would you like to proceed ?").replace("{quantity}",this.unitPair.from.realQuantity).replace("{destinationCount}",Math.floor(this.unitPair.to.quantity)).replace("{source}",this.unitPair.from.unit.name).replace("{destination}",this.unitPair.to.unit.name),onAction:f=>{f?t(!0):r(!1)}})});return this.proceedConversionSubmissions()}catch{return}try{const s=await new Promise((t,r)=>{V.show(j,{title:u("Confirm Conversion"),message:u("You're about to convert {quantity}({source}) to {destinationCount}({destination}). Would you like to proceed?").replace("{quantity}",this.unitPair.from.quantity).replace("{destinationCount}",Math.floor(this.unitPair.to.quantity)).replace("{source}",this.unitPair.from.unit.name).replace("{destination}",this.unitPair.to.unit.name),onAction:f=>{f?t(!0):r(!1)}})});return this.proceedConversionSubmissions()}catch{return}},proceedConversionSubmissions(){this.isLoading=!0,nsHttpClient.post(`/api/products/${this.unitQuantity.product_id}/units/conversion`,{from:this.unitPair.from.unit.id,to:this.unitPair.to.unit.id,quantity:this.unitPair.from.realQuantity}).subscribe({next:s=>(this.isLoading=!1,this.popup.close(),this.popup.params.resolve(s),L.success(u("Conversion Successful"),u("The product {product} has been converted successfully.").replace("{product}",this.product.name))),error:s=>(this.isLoading=!1,this.popup.params.reject(s),L.error(u("An error occured"),s.message||u("An error occured while converting the product {product}").replace("{product}",this.product.name)))})},handlePairUnitUpdated(s){const t=this.selectedUnitPair();t.unitQuantity=this.unitQuantities.filter(f=>f.unit.id===s.value)[0],t.unit=t.unitQuantity.unit,t.fields[0].value=s.value;const r=t===this.unitPair.from?this.unitPair.to:this.unitPair.from;r.unit.id===t.unit.id&&(r.unitQuantity=this.unitQuantities.filter(f=>f.unit.id!==t.unit.id)[0],r.unit=r.unitQuantity.unit,r.fields[0].value=r.unit.id),this.updateFromPairQuantity(this.unitPair.from.quantity)},updateFromPairQuantity(s){s.length===0&&(s=0),s>this.unitPair.from.unitQuantity.quantity&&(s=this.unitPair.from.unitQuantity.quantity,m.info(u("The quantity has been set to the maximum available"))),this.unitPair.from.quantity=parseFloat(s);const t=this.unitQuantities.filter(o=>o.unit.base_unit)[0];if(t.length===0)return L.error(u("An error occured"),u("The product {product} has no base unit").replace("{product}",this.product.name));const f=this.unitPair.from.quantity*this.unitPair.from.unit.value*t.unit.value/this.unitPair.to.unit.value;this.unitPair.from.unit.value<this.unitPair.to.unit.value?this.unitPair.from.realQuantity=Math.floor(f)*this.unitPair.to.unit.value:this.unitPair.from.realQuantity=this.unitPair.from.quantity,this.unitPair.to.quantity=f},switchPair(){const s=this.unitPair.from.unit,t=this.unitPair.to.unit;this.unitPair.from.unit=t,this.unitPair.from.unitQuantity=this.unitQuantities.filter(r=>r.unit.id===t.id)[0],this.unitPair.from.quantity=Math.floor(this.unitPair.to.quantity),this.unitPair.to.unit=s,this.unitPair.to.unitQuantity=this.unitQuantities.filter(r=>r.unit.id===s.id)[0],this.updateFromPairQuantity(this.unitPair.from.quantity)},selectedUnitPair(){return this.unitPair[this.unitPair.from.selected?"from":"to"]},setVisible(s,t){const r=t==="from"?"to":"from";s[t].selected=!0,s[r].selected=!1},loadProductQuantities(){nsHttpClient.get("/api/products/"+this.unitQuantity.product_id+"/units/quantities").subscribe({next:s=>{this.unitQuantities=s,this.unitPair.from.unit=this.unitQuantity.unit,this.unitPair.from.unitQuantity=this.unitQuantity,this.unitPair.from.fields[0].value=this.unitQuantity.unit.id,this.unitPair.from.fields[0].options=s.map(t=>({label:t.unit.name,value:t.unit.id})),this.unitPair.to.unit=s.filter(t=>t.unit.id!==this.unitQuantity.unit.id)[0].unit,this.unitPair.to.unitQuantity=s.filter(t=>t.unit.id!==this.unitQuantity.unit.id)[0],this.unitPair.to.fields[0].value=this.unitPair.to.unit.id,this.unitPair.to.fields[0].options=s.map(t=>({label:t.unit.name,value:t.unit.id}))}})}}},Ri={class:"shadow-lg w-6/7-screen lg:w-3/5-screen ns-box overflow-hidden flex flex-col"},$i={class:"p-2 border-b ns-box-header text-fontcolor text-center font-medium flex justify-between items-center"},Li={class:"relative"},Ii={class:"border-b border-box-edge"},Mi={class:"flex"},Yi={class:"font-bold text-3xl"},Ni={class:"border-r border-box-edge relative"},Bi={class:"font-bold text-3xl"},Wi={class:"p-2 border-b border-box-edge"},Gi={class:""},Hi={key:0,class:"top-0 left-0 absolute h-full w-full flex items-center justify-center",style:{background:"rgb(121 121 121 / 20%)"}},Ei={key:1,class:"flex items-center h-full justify-center"};function zi(s,t,r,f,o,n){const y=h("ns-close-button"),d=h("ns-field"),c=h("ns-numpad"),v=h("ns-spinner");return l(),a("div",Ri,[o.unitQuantities.length>0?(l(),a(x,{key:0},[e("div",$i,[e("div",null,i(n.__("Unit Conversion : {product}").replace("{product}",r.product.name)),1),e("div",null,[b(y,{onClick:t[0]||(t[0]=p=>r.popup.close())})])]),e("div",Li,[e("div",Ii,[e("div",Mi,[e("div",{class:T(["p-2 w-full md:w-1/2 flex flex-col items-center justify-center",o.unitPair.from.selected?"bg-info-primary text-white":""]),onClick:t[1]||(t[1]=p=>n.setVisible(o.unitPair,"from"))},[e("span",null,i(o.unitPair.from.unit.name),1),e("h3",Yi,i(o.unitPair.from.quantity),1)],2),e("div",Ni,[e("div",{class:"rounded-full h-12 w-12 flex items-center justify-center absolute shadow bg-input-button p-2",onClick:t[2]||(t[2]=p=>n.switchPair()),style:{position:"absolute",left:"-22px",top:"14px"}},t[8]||(t[8]=[e("i",{class:"las la-exchange-alt text-3xl"},null,-1)]))]),e("div",{class:T(["p-2 w-full md:w-1/2 flex flex-col items-center justify-center",o.unitPair.to.selected?"bg-info-primary text-white":""]),onClick:t[3]||(t[3]=p=>n.setVisible(o.unitPair,"to"))},[e("span",null,i(o.unitPair.to.unit.name),1),e("h3",Bi,i(Math.floor(o.unitPair.to.quantity)),1)],2)])]),e("div",Wi,[(l(!0),a(x,null,w(n.selectedUnitPair().fields,p=>(l(),k(d,{onChange:t[4]||(t[4]=g=>n.handlePairUnitUpdated(g)),field:p},null,8,["field"]))),256))]),e("div",Gi,[b(c,{onNext:t[6]||(t[6]=p=>n.submitConvertion()),value:o.unitPair.from.quantity,onChanged:t[7]||(t[7]=p=>n.updateFromPairQuantity(p))},{"numpad-footer":P(()=>[e("div",{onClick:t[5]||(t[5]=p=>n.updateFromPairQuantity(o.unitPair.from.unitQuantity.quantity)),class:"w-full ns-numpad-key h-24 font-bold flex items-center justify-center cursor-pointer col-span-3"},i(n.__("Convert {quantity} available").replace("{quantity}",o.unitPair.from.unitQuantity.quantity)),1)]),_:1},8,["value"])]),o.isLoading?(l(),a("div",Hi,[b(v,{size:"24"})])):_("",!0)])],64)):_("",!0),o.unitQuantities.length===0?(l(),a("div",Ei,[b(v)])):_("",!0)])}const Ki=Q(Ti,[["render",zi]]),Ji={name:"ns-products-preview",props:["popup","product"],computed:{product(){return this.popup.params.product}},methods:{__:u,nsCurrency:U,changeActiveTab(s){this.active=s,this.active==="units-quantities"&&this.loadProductQuantities()},loadProductQuantities(){console.log("is loadinfg"),this.hasLoadedUnitQuantities=!1,C.get(`/api/products/${this.product.id}/units/quantities`).subscribe({next:s=>{this.unitQuantities=s,this.hasLoadedUnitQuantities=!0}})},async convert(s,t){try{const r=await new Promise((f,o)=>{Popup.show(Ki,{unitQuantity:s,product:t,resolve:f,reject:o})});this.loadProductQuantities()}catch(r){console.log({exception:r})}}},data(){return{active:"units-quantities",unitQuantities:[],hasLoadedUnitQuantities:!1}},mounted(){this.loadProductQuantities()}},Xi={class:"shadow-lg w-6/7-screen lg:w-3/5-screen ns-box overflow-hidden flex flex-col"},Zi={class:"p-2 border-b ns-box-header text-fontcolor text-center font-medium flex justify-between items-center"},er={class:"flex-auto overflow-y-auto ns-box-body"},tr={class:"p-2"},sr={key:0,class:"table ns-table w-full"},nr={class:"p-1 border"},ir={width:"150",class:"text-right p-1 border"},rr={width:"150",class:"text-right p-1 border"},or={width:"150",class:"text-right p-1 border"},lr={class:"p-1 border text-left"},dr=["onClick"],ar={class:"p-1 border text-right"},ur={class:"p-1 border text-right"},cr={class:"p-1 border text-right"};function fr(s,t,r,f,o,n){const y=h("ns-close-button"),d=h("ns-spinner"),c=h("ns-tabs-item"),v=h("ns-tabs");return l(),a("div",Xi,[e("div",Zi,[e("div",null,i(n.__("Previewing :"))+" "+i(n.product.name),1),e("div",null,[b(y,{onClick:t[0]||(t[0]=p=>r.popup.close())})])]),e("div",er,[e("div",tr,[b(v,{active:o.active,onActive:t[1]||(t[1]=p=>n.changeActiveTab(p))},{default:P(()=>[b(c,{label:n.__("Units & Quantities"),identifier:"units-quantities"},{default:P(()=>[o.hasLoadedUnitQuantities?(l(),a("table",sr,[e("thead",null,[e("tr",null,[e("th",nr,i(n.__("Unit")),1),e("th",ir,i(n.__("Sale Price")),1),e("th",rr,i(n.__("Wholesale Price")),1),e("th",or,i(n.__("Quantity")),1)])]),e("tbody",null,[(l(!0),a(x,null,w(o.unitQuantities,p=>(l(),a("tr",{key:p.id},[e("td",lr,[S(i(p.unit.name)+" ",1),n.product.rawType==="materialized"&&n.product.rawStockManagement==="enabled"?(l(),a(x,{key:0},[t[2]||(t[2]=S(" — ")),e("a",{onClick:g=>n.convert(p,n.product),class:"text-sm text-info-secondary hover:underline border-dashed",href:"javascript:void(0)"},i(n.__("Convert")),9,dr)],64)):_("",!0)]),e("td",ar,i(n.nsCurrency(p.sale_price)),1),e("td",ur,i(n.nsCurrency(p.wholesale_price)),1),e("td",cr,i(p.quantity),1)]))),128))])])):_("",!0),o.hasLoadedUnitQuantities?_("",!0):(l(),k(d,{key:1,size:"16",border:"4"}))]),_:1},8,["label"])]),_:1},8,["active"])])])])}const pr=Q(Ji,[["render",fr]]),_r={name:"ns-drivers-status-popup",props:["popup","row","component"],methods:{__:u,popupCloser:A,popupResolver:O,loadDriverStatusFields(){nsHttpClient.get("/api/fields/driver-status-fields").subscribe({next:s=>{this.loaded=!0,this.fields=this.validation.createFields(s)},error:s=>{this.loaded=!0,m.error(s.message),this.errorMessage=s.message}})},changeStatus(){this.validation.validateFields(this.fields)?Popup.show(j,{title:u("Confirm Your Action"),message:u("Are you sure you want to change the status of the driver?"),onAction:s=>{nsHttpClient.post(`/api/drivers/${this.row.id}/status`,this.validation.extractFields(this.fields)).subscribe({next:t=>{m.success(t.message),this.popupResolver(!0),this.component.$emit("reload")},error:t=>m.error(t.message)})}}):m.error(u("Make sure to choose a status for the driver."))}},data(){return{loaded:!1,validation:new F,fields:[],errorMessage:""}},mounted(){console.log(this.row),this.popupCloser(),this.loadDriverStatusFields()}},hr={class:"shadow ns-box w-[95vw] md:w-[60vw] lg:w-[40vw] xl:w-[30vw]"},mr={class:"p-2 flex justify-between items-center ns-box-header border-b"},br={class:"ns-box-body"},yr={key:0,class:"py-4 flex justify-center items-center"},vr={key:2,class:"p-2"},xr={class:"border-t ns-box-footer p-2 flex justify-end"};function wr(s,t,r,f,o,n){const y=h("ns-close-button"),d=h("ns-spinner"),c=h("ns-notice"),v=h("ns-field"),p=h("ns-button");return l(),a("div",hr,[e("div",mr,[e("h3",null,i(n.__("Driver: {name}").replace("{name}",r.row.username)),1),e("div",null,[b(y,{onClick:t[0]||(t[0]=g=>n.popupResolver(!1))})])]),e("div",br,[o.loaded?_("",!0):(l(),a("div",yr,[b(d)])),o.errorMessage?(l(),k(c,{key:1,color:"error"},{description:P(()=>[S(i(o.errorMessage),1)]),_:1})):(l(),a("div",vr,[(l(!0),a(x,null,w(o.fields,g=>(l(),k(v,{field:g},null,8,["field"]))),256))]))]),e("div",xr,[b(p,{onClick:t[1]||(t[1]=g=>n.changeStatus())},{default:P(()=>[S(i(n.__("Change Status")),1)]),_:1})])])}const gr=Q(_r,[["render",wr]]),Pr={name:"foo-bar",methods:{__:u,popupResolver:O,popupCloser:A,updateOrder(){V.show(j,{title:u("Are you sure?"),message:u("Are you sure you want to update the order?"),onAction:()=>{nsHttpClient.post(`/api/drivers/order/${this.order.id}`,{order:this.order}).subscribe({next:s=>{this.loaded=!0,nsSnackBar.success(u("Order updated successfully")),this.popupResolver(!1)},error:s=>{this.loaded=!0,nsSnackBar.error(s.message)}})}})},loadFields(){this.loaded=!1,nsHttpClient.get("/api/fields/ns.order-delivery-proof").subscribe({next:s=>{this.loaded=!0,this.fields=this.validation.createFields(s)},error:s=>{this.loaded=!0,nsSnackBar.error(s.message)}})}},data(){return{fields:[],validation:new F,loaded:!1}},mounted(){this.loadFields()},props:["order","popup"]},kr={class:"ns-box w-[95vw] md:w-[60vw] lg:w-[40vw] xl:w-[30vw] h-[95vh] md:h-[80vh] shadow flex flex-col"},Cr={class:"p-2 flex justify-between items-center ns-box-header border-b"},jr={class:"box-body overflow-y-auto flex-auto"},Sr={key:0,class:"py-4 flex justify-center items-center"},Qr={key:1,class:"p-2"},Vr={class:"border-t ns-box-footer p-2 flex justify-end"};function qr(s,t,r,f,o,n){const y=h("ns-close-button"),d=h("ns-spinner"),c=h("ns-field"),v=h("ns-button");return l(),a("div",kr,[e("div",Cr,[e("h3",null,i(n.__("Order: {name}").replace("{name}",r.order.code)),1),e("div",null,[b(y,{onClick:t[0]||(t[0]=p=>n.popupResolver(!1))})])]),e("div",jr,[o.loaded?_("",!0):(l(),a("div",Sr,[b(d)])),o.fields.length>0?(l(),a("div",Qr,[(l(!0),a(x,null,w(o.fields,p=>(l(),k(c,{field:p},null,8,["field"]))),256))])):_("",!0)]),e("div",Vr,[b(v,{onClick:t[1]||(t[1]=p=>n.updateOrder())},{default:P(()=>[S(i(n.__("Save")),1)]),_:1})])])}const Ur=Q(Pr,[["render",qr]]),H={nsOrderPreview:ki,nsProductPreview:pr,nsAlertPopup:se,nsConfirmPopup:j,nsPromptPopup:z,nsMediaPopup:te,nsProcurementQuantity:Di,nsOrdersRefund:K,nsSelectPopup:E,nsPOSLoadingPopup:ee,nsDriversStatusPopup:gr,NsDriversOrdersPopup:Ur};for(let s in H)window[s]=H[s];const I=ne({data(){return{popups:[],defaultClass:"absolute top-0 left-0 z-10 w-full h-full items-center flex overflow-y-auto justify-center is-popup"}},mounted(){nsState.subscribe(s=>{s.popups!==void 0&&(document.body.focus(),this.popups=re(s.popups),this.$forceUpdate())})},methods:{closePopup(s,t){(Object.values(t.target.classList).includes("is-popup")&&s.config!==void 0&&[void 0,!0].includes(s.config.closeOnOverlayClick)||Object.keys(s.config).length===0)&&(s.params&&typeof s.params.reject=="function"?(s.params.reject(!1),typeof s.close=="function"&&s.close(),t.stopPropagation()):s.close())},preventPropagation(s){s.stopImmediatePropagation()}}});for(let s in N)I.component(s,N[s]);document.addEventListener("DOMContentLoaded",()=>{I.mount("#dashboard-popups"),window.nsPopups=I});
